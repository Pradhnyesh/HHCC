<div class="admin-container">
  <!-- Header -->
  <div class="admin-header">
    <div class="header-content">
      <h1 class="admin-title">Admin Dashboard</h1>
      <p class="admin-subtitle">
        Manage all appointments and services
        <span *ngIf="selectedTimePeriod !== 'all'" class="filter-indicator">
          â€¢ Showing data for: <strong>{{getSelectedTimePeriodLabel()}}</strong>
        </span>
      </p>
    </div>
    <div class="header-actions">
      <!-- Notification Bell -->
      <div class="notification-container">
        <button class="notification-btn" (click)="toggleNotifications()" [class.has-notifications]="hasUnreadNotifications">
          <span class="bell-icon">ğŸ””</span>
          <span class="notification-badge" *ngIf="unreadNotificationCount > 0">{{unreadNotificationCount}}</span>
        </button>
        
        <!-- Notification Dropdown -->
        <div class="notification-dropdown" *ngIf="showNotifications" (click)="$event.stopPropagation()">
          <div class="notification-header">
            <h3>Notifications</h3>
            <button class="mark-all-read" (click)="markAllAsRead()" *ngIf="hasUnreadNotifications">
              Mark all as read
            </button>
          </div>
          
          <div class="notification-list" *ngIf="notifications.length > 0; else noNotifications">
            <div class="notification-item" 
                 *ngFor="let notification of notifications" 
                 [class.unread]="!notification.isRead"
                 (click)="markAsRead(notification.id)">
              <div class="notification-content">
                <p class="notification-message">{{notification.message}}</p>
                <div class="notification-meta">
                  <span class="notification-user">From: {{notification.senderName || 'Anonymous'}}</span>
                  <span class="notification-time">{{formatNotificationTime(notification.timestamp)}}</span>
                </div>
              </div>
              <div class="notification-actions" *ngIf="!notification.isRead">
                <span class="unread-dot"></span>
              </div>
            </div>
          </div>
          
          <ng-template #noNotifications>
            <div class="no-notifications">
              <span class="no-notifications-icon">ğŸ“­</span>
              <p>No notifications yet</p>
            </div>
          </ng-template>
          
          <div class="notification-footer" *ngIf="notifications.length > 0">
            <button class="view-all-btn" (click)="viewAllNotifications()">View All</button>
          </div>
        </div>
      </div>
      
      <button class="btn btn-secondary" (click)="exportAppointments()">
        <span class="btn-icon">ğŸ“Š</span>
        Export Data
      </button>
    </div>
  </div>

  <!-- Statistics Cards -->
  <div class="stats-grid">
    <div class="stat-card total">
      <div class="stat-icon">ğŸ“‹</div>
      <div class="stat-content">
        <h3 class="stat-number">{{stats.total}}</h3>
        <p class="stat-label">Total Appointments</p>
      </div>
    </div>
    
    <div class="stat-card scheduled">
      <div class="stat-icon">ğŸ“…</div>
      <div class="stat-content">
        <h3 class="stat-number">{{stats.scheduled}}</h3>
        <p class="stat-label">Scheduled</p>
      </div>
    </div>
    
    <div class="stat-card completed">
      <div class="stat-icon">âœ…</div>
      <div class="stat-content">
        <h3 class="stat-number">{{stats.completed}}</h3>
        <p class="stat-label">Completed</p>
      </div>
    </div>
    
    <div class="stat-card today">
      <div class="stat-icon">ğŸ¯</div>
      <div class="stat-content">
        <h3 class="stat-number">{{stats.today}}</h3>
        <p class="stat-label">Today</p>
      </div>
    </div>
  </div>

  <!-- Filters Section -->
  <div class="filters-section">
    <h2 class="section-title">Filter Appointments</h2>
    
    <div class="filters-grid">
      <div class="filter-group">
        <label for="timePeriodFilter">Time Period</label>
        <select id="timePeriodFilter" [(ngModel)]="selectedTimePeriod" (change)="onFilterChange()" class="filter-select">
          <option *ngFor="let period of timePeriods" [value]="period.value">{{period.label}}</option>
        </select>
      </div>

      <div class="filter-group">
        <label for="statusFilter">Status</label>
        <select id="statusFilter" [(ngModel)]="selectedStatus" (change)="onFilterChange()" class="filter-select">
          <option value="all">All Status</option>
          <option value="scheduled">Scheduled</option>
          <option value="completed">Completed</option>
          <option value="cancelled">Cancelled</option>
        </select>
      </div>

      <div class="filter-group">
        <label for="serviceFilter">Service</label>
        <select id="serviceFilter" [(ngModel)]="selectedService" (change)="onFilterChange()" class="filter-select">
          <option value="all">All Services</option>
          <option *ngFor="let service of services" [value]="service">{{service}}</option>
        </select>
      </div>

      <div class="filter-group">
        <label for="dateFilter">Specific Date</label>
        <input type="date" id="dateFilter" [(ngModel)]="selectedDate" (change)="onFilterChange()" class="filter-input">
      </div>

      <div class="filter-group">
        <label for="searchFilter">Search</label>
        <input type="text" id="searchFilter" [(ngModel)]="searchQuery" (input)="onFilterChange()" 
               placeholder="Search by name, service, user..." class="filter-input">
      </div>
    </div>
  </div>

  <!-- Appointments Table -->
  <div class="table-section">
    <div class="table-header">
      <h2 class="section-title">All Appointments ({{filteredAppointments.length}})</h2>
      <!-- <div class="table-info">
        Showing {{(currentPage - 1) * itemsPerPage + 1}} - {{Math.min(currentPage * itemsPerPage, filteredAppointments.length)}} of {{filteredAppointments.length}}
      </div> -->
    </div>

    <div class="table-container" *ngIf="filteredAppointments.length > 0; else noAppointments">
      <table class="appointments-table">
        <thead>
          <tr>
            <th>ID</th>
            <th>Member</th>
            <th>Type</th>
            <th>Service</th>
            <th>Date & Time</th>
            <th>User</th>
            <th>Status</th>
            <th>Pickup</th>
            <th>Actions</th>
          </tr>
        </thead>
        <tbody>
          <tr *ngFor="let appointment of getPaginatedAppointments()" 
              [class]="'appointment-row ' + appointment.status">
            <td class="appointment-id">#{{appointment.id}}</td>
            
            <td class="member-info">
              <div class="member-details">
                <strong>{{appointment.memberName}}</strong>
                <div class="member-type">
                  <span class="type-badge" [class.family-type]="appointment.type === 'family'" [class.pet-type]="appointment.type === 'pet'">
                    {{appointment.type === 'family' ? 'ğŸ‘¨â€ğŸ‘©â€ğŸ‘§â€ğŸ‘¦' : 'ğŸ•'}} {{appointment.type}}
                  </span>
                </div>
              </div>
            </td>

            <td class="service-type">
              <span class="service-badge">{{appointment.type | titlecase}}</span>
            </td>
            
            <td class="service-name">{{appointment.service}}</td>
            
            <td class="datetime-info">
              <div class="date">ğŸ“… {{appointment.date}}</div>
              <div class="time">ğŸ• {{appointment.time}}</div>
            </td>
            
            <td class="user-info">
              <div class="user-details">
                <strong>{{appointment.userInfo?.userName}}</strong>
                <div class="user-email">{{appointment.userInfo?.userEmail}}</div>
                <div class="user-phone" *ngIf="appointment.userInfo?.userPhone">{{appointment.userInfo?.userPhone}}</div>
              </div>
            </td>
            
            <td class="status-cell">
              <span class="status-badge" [class]="appointment.status + '-status'">
                {{appointment.status | titlecase}}
              </span>
            </td>
            
            <td class="pickup-info">
              <span *ngIf="appointment.pickupDrop" class="pickup-yes">ğŸš— Yes</span>
              <span *ngIf="!appointment.pickupDrop" class="pickup-no">âŒ No</span>
            </td>
            
            <td class="actions-cell">
              <button class="btn-small btn-info" (click)="showAppointmentDetails(appointment)">
                ğŸ‘ï¸ View
              </button>
            </td>
          </tr>
        </tbody>
      </table>
    </div>

    <ng-template #noAppointments>
      <div class="empty-state">
        <div class="empty-icon">ğŸ“‹</div>
        <h3 class="empty-title">No Appointments Found</h3>
        <p class="empty-description">No appointments match your current filters</p>
      </div>
    </ng-template>

    <!-- Pagination -->
    <div class="pagination" *ngIf="totalPages > 1">
      <button class="pagination-btn" [disabled]="currentPage === 1" (click)="changePage(currentPage - 1)">
        â† Previous
      </button>
      
      <div class="pagination-numbers">
        <button *ngFor="let page of [].constructor(totalPages); let i = index" 
                class="pagination-number" 
                [class.active]="currentPage === i + 1"
                (click)="changePage(i + 1)">
          {{i + 1}}
        </button>
      </div>
      
      <button class="pagination-btn" [disabled]="currentPage === totalPages" (click)="changePage(currentPage + 1)">
        Next â†’
      </button>
    </div>
  </div>
</div>

<!-- Appointment Details Modal -->
<div class="modal" *ngIf="showAppointmentDetailsModal" (click)="closeAppointmentDetails()">
  <div class="modal-content appointment-details-modal" (click)="$event.stopPropagation()">
    <div class="modal-header">
      <h2 class="modal-title">Appointment Details - #{{selectedAppointment?.id}}</h2>
      <button class="modal-close" (click)="closeAppointmentDetails()">Ã—</button>
    </div>
    
    <div class="modal-body" *ngIf="selectedAppointment">
      <div class="details-grid">
        <!-- Member Information -->
        <div class="detail-section">
          <h3 class="section-subtitle">Member Information</h3>
          <div class="detail-item">
            <strong>Name:</strong> {{selectedAppointment.memberName}}
          </div>
          <div class="detail-item">
            <strong>Type:</strong> 
            <span class="type-badge" [class.family-type]="selectedAppointment.type === 'family'" [class.pet-type]="selectedAppointment.type === 'pet'">
              {{selectedAppointment.type === 'family' ? 'ğŸ‘¨â€ğŸ‘©â€ğŸ‘§â€ğŸ‘¦' : 'ğŸ•'}} {{selectedAppointment.type | titlecase}}
            </span>
          </div>
        </div>

        <!-- Appointment Information -->
        <div class="detail-section">
          <h3 class="section-subtitle">Appointment Information</h3>
          <div class="detail-item">
            <strong>Service:</strong> {{selectedAppointment.service}}
          </div>
          <div class="detail-item">
            <strong>Date:</strong> {{selectedAppointment.date}}
          </div>
          <div class="detail-item">
            <strong>Time:</strong> {{selectedAppointment.time}}
          </div>
          <div class="detail-item">
            <strong>Status:</strong> 
            <span class="status-badge" [class]="selectedAppointment.status + '-status'">
              {{selectedAppointment.status | titlecase}}
            </span>
          </div>
        </div>

        <!-- User Information -->
        <div class="detail-section">
          <h3 class="section-subtitle">User Information</h3>
          <div class="detail-item">
            <strong>Name:</strong> {{selectedAppointment.userInfo?.userName}}
          </div>
          <div class="detail-item">
            <strong>Email:</strong> {{selectedAppointment.userInfo?.userEmail}}
          </div>
          <div class="detail-item" *ngIf="selectedAppointment.userInfo?.userPhone">
            <strong>Phone:</strong> {{selectedAppointment.userInfo?.userPhone}}
          </div>
        </div>

        <!-- Pickup Information -->
        <div class="detail-section">
          <h3 class="section-subtitle">Pickup & Drop</h3>
          <div class="detail-item">
            <strong>Pickup Service:</strong> 
            <span *ngIf="selectedAppointment.pickupDrop" class="pickup-yes">ğŸš— Yes</span>
            <span *ngIf="!selectedAppointment.pickupDrop" class="pickup-no">âŒ No</span>
          </div>
          <div class="detail-item" *ngIf="selectedAppointment.address">
            <strong>Address:</strong> {{selectedAppointment.address}}
          </div>
        </div>

        <!-- Additional Information -->
        <div class="detail-section full-width" *ngIf="selectedAppointment.notes">
          <h3 class="section-subtitle">Special Notes</h3>
          <div class="notes-content">
            {{selectedAppointment.notes}}
          </div>
        </div>

        <!-- Feedback Information -->
        <div class="detail-section full-width" *ngIf="selectedAppointment.feedback">
          <h3 class="section-subtitle">Customer Feedback</h3>
          <div class="feedback-display">
            <div class="feedback-rating">
              <span class="rating-label">Rating:</span>
              <div class="stars">
                <span *ngFor="let star of [1,2,3,4,5]" 
                      class="star" 
                      [class.filled]="star <= selectedAppointment.feedback!.rating">â˜…</span>
              </div>
              <span class="rating-text">({{selectedAppointment.feedback.rating}}/5)</span>
            </div>
            <div class="feedback-comment" *ngIf="selectedAppointment.feedback.comment">
              <strong>Comment:</strong> "{{selectedAppointment.feedback.comment}}"
            </div>
            <div class="feedback-date">
              <strong>Given on:</strong> {{selectedAppointment.feedback.givenAt | date:'medium'}}
            </div>
          </div>
        </div>
      </div>

      <!-- Status Update Actions -->
      <div class="status-actions" *ngIf="selectedAppointment.status !== 'completed'">
        <h3 class="section-subtitle">Update Status</h3>
        <div class="action-buttons">
          <button class="btn btn-success" 
                  *ngIf="selectedAppointment.status === 'scheduled'"
                  (click)="updateAppointmentStatus(selectedAppointment.id, 'completed')">
            âœ… Mark as Completed
          </button>
          <button class="btn btn-warning" 
                  *ngIf="selectedAppointment.status === 'scheduled'"
                  (click)="updateAppointmentStatus(selectedAppointment.id, 'cancelled')">
            âŒ Cancel Appointment
          </button>
          <button class="btn btn-primary" 
                  *ngIf="selectedAppointment.status === 'cancelled'"
                  (click)="updateAppointmentStatus(selectedAppointment.id, 'scheduled')">
            ğŸ”„ Reschedule
          </button>
        </div>
      </div>
    </div>
  </div>
</div>
